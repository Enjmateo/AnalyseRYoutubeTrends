---
title: "Analyse des tendances Youtube"
output:
  pdf_document: default
  html_document:
    df_print: paged
date: "2023-01-03"
---

```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE) 

#install.packages(c("jsonlite", "purrr", "readr", "dplyr", "tidyr", "plyr", "tidyverse"))
```

```{r imports, echo=FALSE, message = FALSE}
library(jsonlite)
library(purrr)
library(readr)
library(dplyr)
library(tidyr)
library(plyr)
library(tidyverse)
library(lubridate)
```

```{r json, echo=FALSE, message = FALSE}
# Récupération des catégories
data = fromJSON("FR_category_id.json")
items = data$items
labels = items[4]$snippet$title

#Une fonction permettant de récupérer le libéllé d'une catégorie en fonction en fonction de l'id categorie
get_title <- function(id){
  if (id %in% items[3]$id){
    return(labels[items[3]==id])
  }
  else {
    return("No Category")
  } 
}

```


```{r csvimport, echo=FALSE, message = FALSE}
# Importataion du dataset
dataset <- read_csv("FR_youtube_trending_data.csv")
dataset$tags = strsplit(dataset$tags, '[|]')
dsByViews = dataset[order(-dataset$view_count), ]
```

# Presentation du dataset
Notre étude porte sur les vidéos en tendance sur Youtube de 2020 à aujourd’hui. 
Les vidéos en tendance sont des vidéos mises en avant par Youtube dans un onglet dédié. Ce sont des vidéos qui intéressent de base des utilisateurs, le mécanisme de choix des vidéos en tendance n’est pas public, nous allons donc essayer de déterminer quelques facteurs en commun entre les vidéos en tendances. Nous n’avons cependant pas d’accès à un dataset de vidéo non en tendance. 

Voici les 16 champs dont nous disposons pour chaque vidéo. 

>* **video_id** (string) : Un identifiant unique à chaque * vidéo titre (string): Le titre de la vidéo
* **published_At** (date): Le jour et l’heure où la vidéo a été postée
* **channel_id** (string): Un identifiant unique à chaque chaîne youtube
* **channel_title** (string): Le nom de la chaîne youtube 
* **category_id** (int): L’identifiant de la catégorie (de 1 à 29)
* **trending_date** (date): L’heure à laquelle la vidéo a été vue dans les tendances
* **tags** (string): Les tags de la vidéo 
* **view_count** (int): Le nombre de vue 
* **likes** (int): Le nombre de like 
* **dislikes** (int): Le nombre de dislike 
* **comment_count** (int): Le nombre de commentaires 
* **thumbnail** link (string): Le lien de la miniature de la vidéo 
* **comments disabled** (boolean): Si les commentaires ont été désactivés ou non 
* **rating disabled** (boolean): Si les likes/dislikes ont été désactivés ou non 
* **description** (string): La description de la vidéo

À partir de ces **175790** lignes de données, nous allons essayer de trouver des pattern nous permettant de comprendre davantage le fonctionnement des tendances. N’oubliez pas de lire ce rapport jusqu’à la fin, nous vous donnerons des conseils tout au long de ce dernier pour vous aider à maximiser vos résultats pour votre prochain lancement de chaîne Youtube.

Voici le lien vers notre dataset, notre code, et notre rapport : 
[github](https://github.com)

> *Comment percer sur Youtube ?*

# Choisir un thème de chaîne 

Pour passer en tendance sur youtube, il vous faut une vidéo ! La première chose à faire va donc être de déterminer quel type de vidéo est celui le plus à même de passer en tendance. Voici les types les plus présents en tendance sur la plateforme entre 2020 et 2023. 

```{r image1, echo=FALSE, message = FALSE, fig.width = 8,fig.height = 5.5}
count_category <- dataset %>% 
  group_by(categoryId) %>% 
  dplyr::summarise(n = n())
count_category <- count_category %>% 
  mutate(Category = unlist(lapply(count_category$categoryId,get_title)))

ggplot(count_category, aes(x=reorder(Category,n), y=n, fill=Category)) +
  geom_bar(stat="identity")+theme_minimal() + 
  theme(axis.text.x = element_text(angle = 90))+ labs(x = "Category", y = "Number of video")
ggsave("graph1.png")
```
Comme vous pouvez le constater (Figure 1), les 3 premières catégories représentent quasiment 100k vidéos. Si on va jusqu’à la cinquième catégorie, on se retrouve alors avec presque 133k vidéos, soit un peu plus de 75% de la totalité des vidéos en tendance. 

Cela ne veut pas dire qu’il faut forcément oublier les autres catégories - ni que ce sont ces catégories-là qui font le plus de vues - mais cela reste une information à prendre en compte pour la suite.


Voici le même graphique que celui vu ci-dessus, mais sur les 10k vidéos des tendances avec le plus de vues, toutes périodes confondues. Comme vous pouvez le voir, même si la musique et le divertissement n’ont pas bougé, les autres catégories ont subi quelques changements de place. 

```{r image2, echo=FALSE, message = FALSE, fig.width = 8,fig.height = 5.5}
# Graphe des catégories des 10.000 vidéos avec le plus de vues 
#dsByViews = dataset[order(-data$view_count), ]

count_top_category <- head(dsByViews,10000) %>% 
  group_by(categoryId) %>% 
  dplyr::summarise(n = n())

count_top_category <- count_top_category %>%
  mutate(Category = unlist(lapply(count_top_category$categoryId,get_title)))

ggplot(count_top_category, aes(x=reorder(Category,n), y=n, fill=Category)) +
  geom_bar(stat="identity")+theme_minimal() + 
  theme(axis.text.x = element_text(angle = 90))+ labs(x = "Category", y = "Number of video")
```
On se rend surtout compte que la moitié des 10.000 vidéos les plus vues en tendance sont des musiques. Et si on reprend le même raisonnement que plus haut, les 3 catégories avec le plus de vidéos représentent près de 80% des 10.000 vidéos les plus vues en tendance. 


Notre premier conseil est donc celui-ci, privilégiez les contenus en tendance comme la musique, le divertissement, le sport ou encore le gaming pour avoir plus de chance de passer en tendance ! 

Étant donné que l'on cherche à devenir youtubeur et non pas un artiste musical, on concentrera à partir de maintenant notre analyse sur les vidéos qui ne sont pas des musiques. On enlèvera aussi les films et bandes annonces.
```{r filtreCat, echo=FALSE, message = FALSE}
#Filtrer le dataset pour enlever les trailers (1) et clips musicaux (10)
filtred = dsByViews[((dsByViews$categoryId!=10)&(dsByViews$categoryId!=1)),]
#length(dsByViews$video_id)
#ength(filtred$video_id)
```


# Choisir un sujet de vidéo

Afin de choisir un sujet de vidéo, on va analyser les tags des vidéos en tendance ainsi que leur évolution. En effet, la majorité des vidéos ont des tags (113 305/139 121 vidéos filtrées).
Au total, on dénombre 1 925 894 tags, dont 124 780 tags uniques.

```{r tags1, echo=FALSE, message = FALSE}
#On split les tags
tags = unlist(filtred$tags)
df_tags_qyt <- as.data.frame(table(tags))
videosWithoutTags = df_tags_qyt$Freq[df_tags_qyt$tags=="[None]"]
differentsTags = length(df_tags_qyt[,1])
```

## Analyse quantitative des tags

On va tout d'abord analyser les tags les plus utilisés dans les vidéos en tendances pour essayer de déterminer quels tags choisir afin de finir en tendance.

Ici, vous pouvez voir les 10 tags les plus utilisés :

| Tags      | Freq |
|-----------|------|
| humour    | 9117 |
| football  | 6038 |
| vlog      | 3972 |
| drole     | 3416 |
| challenge | 3400 |
| fun       | 3366 |
| france    | 3244 |
| foot      | 2950 |
| fortnite  | 2889 |
| résumé    | 2876 |

```{r tags2, echo=FALSE, message = FALSE}
df_tagsbyfreq = df_tags_qyt[order(-df_tags_qyt$Freq), ]
#On exclu le 1er car il s'agit des videos sans tag:
df_best10tags = df_tagsbyfreq[(2:11),]
```


On va regarder l'évolution de ces 10 tags au fil des trois dernières années (on exclura 2023 car nous 'avons pas assez de données représentatives pour le moment) afin de déterminer si un thème en particulier est en hausse et serait intéressant à traiter en vidéo.

```{r tags3, echo=FALSE, message = FALSE}
#On recupère les champs qui nous interessent
tagsbydate = filtred[,c("publishedAt","tags")]
#On classe les videos par mois années
tagsbydate$publishedAt = format(as.Date(tagsbydate$publishedAt), "%Y-%m")
#On enlève 2023 car pas assez de videos pour être représenatatif
tagsbydate = tagsbydate[tagsbydate$publishedAt<2023,]
#On unroll les différents tags de chaque video
unrolltags = tagsbydate %>% unnest(c(tags, publishedAt))
#On somme les tags par année
sumtags = ddply(unrolltags, .(publishedAt, tags), summarize, qtytags=count(tags)$freq)
```

```{r tags4, echo=FALSE, message = FALSE}
tagsCountAllTime = count(unrolltags$tags)
#On récupère les 15 premiers tags (excepté le premier car c'est les sans tag pour plus de lisibilité)
best10tags = df_best10tags$tags
df_best_10_tags_by_year = sumtags[sumtags$tags %in% best10tags,]
```

```{r tags5, echo=FALSE, message = FALSE, fig.width = 7,fig.height = 3}

ggplot(df_best_10_tags_by_year, aes(x=publishedAt, y=qtytags, color=tags)) + geom_line(aes(group=tags)) + ggtitle("Evolution du top 10 des tags utilisés") + xlab("Année") + ylab("Nombre de videos par tags") + labs(color = "Tags") + theme(axis.text.x = element_text(angle=45))+
scale_colour_discrete("") + scale_linetype_manual("", values=c(1:11)) + scale_shape_manual("",
values=c(1:11))
```
On peut voir que l'humour reste toujours le thême le plus en tendance et qu'aucun autre thème ne semble tendre à le rattraper.
Un fait étonnant que l'on peut observer est la baisse de vidéos en tendance avec le tag football en décembre 2022 alors qu'on était en pleine période de coupe du monde.

## Analyse en termes de vues des tags

Nous allons maintenant utiliser une autre approche et nous intéresser aux vues des vidéos auxquelles sont associé chaque tag.
Comme précédement, on peut déterminer les 10 tags ayant le plus de vues cumulées sur les 3 dernières années.

| Tags          | Views      |
|---------------|------------|
| humour        | 4339720364 |
| football      | 3052141771 |
| highlights    | 2941895663 |
| video         | 2869564671 |
| michou        | 2745122084 |
| mobile game   | 2365456255 |
| amixem        | 2226818325 |
| mcfly         | 2157475105 |
| carlito       | 2001409177 |
| battle royale | 1998236814 |

```{r tagsV1, echo=FALSE, message = FALSE}
#On récupère les champs qui nous interessent
tagsviewbydate = filtred[,c("publishedAt","tags","view_count")]
#On classe les videos par années et mois
tagsviewbydate$publishedAt = format(as.Date(tagsviewbydate$publishedAt), "%Y-%m")
#tagsbydate$publishedAt = year(tagsbydate$publishedAt)
#On enlève 2023 car pas assez de videos 
tagsviewbydate = tagsviewbydate[tagsviewbydate$publishedAt<2023,]
#On unroll les différents tags de chaque video
unrolltagsviews <-  tagsviewbydate %>% unnest(c(tags, publishedAt))
#On somme les vues des tags par années
df_sumtagsviews = ddply(unrolltagsviews, .(publishedAt, tags), summarize, view_count=sum(view_count))

```

```{r tagsV2, echo=FALSE, message = FALSE}
sumtagsviews = aggregate( cbind(view_count) ~  tags , data = unrolltagsviews , FUN = sum )
best10tagsviews = arrange(sumtagsviews, -sumtagsviews$view_count)[2:11,]
```
Comme précédement, on retrouve en premières positions les tags "humour" et "football" mais le reste est assez différent.
On remarque notamment que les noms de gros createur de la platforme se son rajouté au top 10 ; c'est le cas de Michou, Amixem, Mcfly et Carlito.

Nous allons à nouveau regarder l'évolution temporelle de ces 10 tags.

```{r tagsV3, echo=FALSE, message = FALSE}
#sumtagsview = sumtagsview[sumtagsview$tags=='[None]']
#On récupère les 15 premiers tags (excepté le premier car c'est les sans tag pour plus de lisibilité)
df_besttagsviews = df_sumtagsviews[df_sumtagsviews$tags %in% best10tagsviews$tags,]
```



```{r tagsV4, echo=FALSE, message = FALSE, fig.width = 7,fig.height = 3}

ggplot(df_besttagsviews, aes(x=publishedAt, y=view_count, color=tags)) + geom_line(aes(group=tags))  + ggtitle("Evolution du top 10") + xlab("Année") + ylab("Vues des videos") + labs(color = "Tags") + theme(axis.text.x = element_text(angle=45))+
scale_colour_discrete("") + scale_linetype_manual("", values=c(1:11)) + scale_shape_manual("",
values=c(1:11))
```

La première chose que l'on peut observer est un énorme pic de vues en juin 2021 pour le tag football. Cela correspond à l'euro 2021. Concernant le reste des données, on ne constate pas vraiment de thème particulier 

## Alors, quel sujet choisir pour ma prochaine vidéo ?

Comme on l'a vu précedemment, on a principalement 2 sujets qui reviennent souvent en tendance et qui génèrent beaucoup de vues : l'humour et le foot.
Mais si vraiment je veux mettre toutes les chances de mon côté pour percer, il me faut faire une video Football sur Fortnite mobile avec en invités Michou, Amixem McFly et Carlito (avec une dose d'humour et de challenges bien évidemment!).

# Et si on la jouait méta ?

## ON MET TOUT EN MAJUSCULES ?

Dans les vidéos en tendance, on trouve souvent des vidéos avec des titres en majuscules. Nous avons donc analysé les titres pour savoir la proportion de ceux en majucules. Nous avons trouvé que 36683 vidéos (hors clips musicaux et bandes annonce) ont au moins 50% de leurs caractères en majuscule. Cela représente plus de 26% des vidéos. On peut donc en déduire que mettre ses titres en majuscule est intéressant pour finir en tendances.

```{r defmajuscules, echo=FALSE, message = FALSE}
count_uppercase <- function(string) {
  uppercase <- grep("[A-Z]", unlist(strsplit(string,"")))
  return (length(uppercase))
}
most_uppercase <- function(string) {
  return (count_uppercase(string) > (length(unlist(strsplit(string,"")))/2))
}

```

```{r majuscules, echo=FALSE, message = FALSE}
videoupperacse = unlist(lapply(filtred$title,most_uppercase))
qtyvideouppercase = sum(videoupperacse, na.rm = TRUE)
```
## Faut faire des feats?

Il est souvent dit que pour avoir sa vidéo en tendance, il faut faire des featuring avec d'autres youtubeurs (c'est-à-dire des vidéos à plusieurs). Une pratique commune  lorsque des vidéos incluent des feats est de le preciser dans le titre à l'aide de mots clefs tels que "feat", "ft" ou encore "avec" en français. 
Nous avons donc compté leurs occurrences  afin d'avoir un ordre de grandeur de la quantité de videos comportant des feats. Nous avons trouvé environ 14622 feats sur 139121 vidéos (celles hors clips musicaux et bande annonces de film) soit 10% de ces dernières.
```{r featurings, echo=FALSE, message = FALSE}
titressplit = unlist(strsplit(filtred$title, '[- (),.]'))
titressplit = tolower(titressplit)
titlewords = table(titressplit)
featuringcount = titlewords["feat"]+titlewords["ft"]+titlewords["featuring"]+titlewords["avec"]
```


## A quelle heure poster ? 

Vous avez fini votre première vidéo et vous devez maintenant la poster, il y a-t’il un horaire privilégié par les youtubeurs ? 

```{r heuredepost, echo=FALSE, message = FALSE, fig.width = 3.5,fig.height = 3.5}
# Graphe du nombre de post de vidéos par tranche horaire 
data_hours <- filtred %>%
  mutate(hours = hour(ymd_hms(publishedAt))) %>%
  group_by(hours = hours) %>%
  dplyr::summarize(count = n()) %>%
  mutate(interval = seq(0,23))

ggplot(data_hours, aes(x = hours, y = count, fill = -count)) +
geom_bar(stat = "identity") +coord_polar()+theme(legend.position = "none")+
scale_fill_gradient(low = "#FF0000", high = "#282828") + labs(x = "Hours", y = "Number of video")
```

Comme vous pouvez le voir sur ce graphique (en forme de montre à 24h), les horaires dominants sont dans la tranche 15-17h avec un pic autour de 16h. 

Cet horaire s’explique surtout par le fait que les youtubeurs essaient de se calquer sur les horaires de disponibilités de leurs communautés. En effet, certains gros acteurs de la plateforme comme Michou ou Amixem ont des communautés assez jeunes. Ces horaires-là correspondent à des horaires de sorties d’école/université voire même au plus tard de bureau pour les youtubeurs avec des communautés plus âgées.

Peu d’entre eux postent de nuit ou hors de ces horaires-là car les premières heures des vidéos sur Youtube ont un impact important sur le résultat que la vidéo fait derrière. 

## Déménager pour mieux percer?

Si vous n’arrivez pas à vous trouver dans les grands thèmes des vidéos en tendances en France, peut-être que changer de pays pourra vous y aider. 

```{r compraisonpays, echo=FALSE, message = FALSE}
country_list <- c("FR","US","RU")
for (i in 1:length(country_list)) {
    file_path <- file.path(".", paste(country_list[i],"_youtube_trending_data.csv",sep=""))
    this_data <- read.csv(file_path)
    
    counts_country <- this_data %>%
        group_by(categoryId) %>% 
        dplyr::summarise(sum_view_count = sum(view_count))
    counts_country <- counts_country %>%
        mutate(Category = unlist(lapply(counts_country$categoryId,get_title))) %>%
        mutate(Country = country_list[i])
    
    total_country = sum(counts_country$sum_view_count)
    
    counts_country <- counts_country %>%
        mutate(n_norma = sum_view_count/total_country*100)
    
    if (i==1) {combined_data <- counts_country}
    else {combined_data <- rbind(combined_data, counts_country)}
} 
```

```{r compraisonpaysgraph, echo=FALSE, message = FALSE, fig.width = 7,fig.height = 4}

ggplot(combined_data, aes(x = reorder(Category,n_norma), y = n_norma, fill = Country)) +
  geom_col(position = "dodge") +
  labs(x = "Category", y = "% of Views", fill = "Country") + 
  theme(axis.text.x = element_text(angle = 90))
```
Comme vous pouvez le voir, la Russie et les USA aiment aussi la musique et le divertissement, mais de manière plus équilibrée. 

Si vous êtes un grand fan de gaming, faire un tour aux USA pour augmenter vos chances n’est pas un mauvais choix. Même chose pour les People en Russie.

Si vous êtes un fan de politique, vous pourrez accéder au top 5 en Russie sans même être dans le top 10 Français. À vous de voir si le jeu en vaut la chandelle. 

